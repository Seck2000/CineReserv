@model CineReserv.Models.Reservation

@{
    ViewData["Title"] = "D√©tails de la r√©servation";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">üìã D√©tails de la r√©servation</h2>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>Informations de la r√©servation</h5>
                            <p><strong>Num√©ro :</strong> @Model.NumeroReservation</p>
                            <p><strong>Statut :</strong> 
                                <span class="badge @(Model.Statut == "Confirmee" ? "bg-success" : 
                                                     Model.Statut == "Annulee" ? "bg-danger" : "bg-warning")">
                                    @Model.Statut
                                </span>
                            </p>
                            <p><strong>Date de r√©servation :</strong> @Model.DateReservation.ToString("dd/MM/yyyy √† HH:mm")</p>
                        </div>
                        <div class="col-md-6">
                            <h5>Informations client</h5>
                            <p><strong>Nom :</strong> @Model.NomClient</p>
                            <p><strong>Email :</strong> @Model.EmailClient</p>
                            @if (!string.IsNullOrEmpty(Model.TelephoneClient))
                            {
                                <p><strong>T√©l√©phone :</strong> @Model.TelephoneClient</p>
                            }
                        </div>
                    </div>

                    <hr>

                    <div class="row mb-4">
                        <div class="col-md-4">
                            <img src="@Model.Seance.Film.ImageUrl" class="img-fluid rounded" alt="@Model.Seance.Film.Titre">
                        </div>
                        <div class="col-md-8">
                            <h4>@Model.Seance.Film.Titre</h4>
                            <p class="text-muted">@Model.Seance.Film.Genre ‚Ä¢ @Model.Seance.Film.Duree min</p>
                            <p><strong>Salle :</strong> @Model.Seance.Salle.Nom</p>
                            <p><strong>Date et heure :</strong> @Model.Seance.DateHeure.ToString("dddd dd MMMM yyyy √† HH:mm")</p>
                            <p><strong>Nombre de places :</strong> @Model.NombrePlaces</p>
                            <p><strong>Prix unitaire :</strong> @Model.PrixUnitaire.ToString("C")</p>
                            <p><strong>Total :</strong> <span class="h5 text-primary">@Model.PrixTotal.ToString("C")</span></p>
                            
                            @if (ViewBag.SiegesReserves != null)
                            {
                                <div class="mt-3">
                                    <h6>Si√®ges r√©serv√©s :</h6>
                                    <div class="d-flex flex-wrap gap-2">
                                        @foreach (var siege in ViewBag.SiegesReserves)
                                        {
                                            <span class="badge bg-primary">@siege.NomComplet</span>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a asp-action="Index" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Retour √† mes r√©servations
                        </a>
                        @{
                            // Lien facture si une Invoice existe pour cette r√©servation
                            var invoiceId = ViewBag.InvoiceId as int?;
                        }
                        @if (invoiceId.HasValue && invoiceId.Value > 0)
                        {
                            <a asp-controller="Facturation" asp-action="Details" asp-route-id="@invoiceId" class="btn btn-outline-primary">
                                <i class="fas fa-file-invoice"></i> Voir la facture
                            </a>
                        }
                        @if (Model.Statut == "Confirmee" && Model.Seance.DateHeure > DateTime.Now.AddHours(2))
                        {
                            <form method="post" asp-action="Cancel" class="d-inline">
                                <input type="hidden" name="id" value="@Model.Id" />
                                <button type="submit" class="btn btn-danger" 
                                        onclick="return confirm('√ätes-vous s√ªr de vouloir annuler cette r√©servation ?')">
                                    <i class="fas fa-times"></i> Annuler la r√©servation
                                </button>
                            </form>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

